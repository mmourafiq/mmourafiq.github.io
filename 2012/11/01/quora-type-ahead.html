<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quora Typeahead search. &mdash; Mourad Mourafiq</title>
    <!--[if lt IE 9]><script src='https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js'></script><![endif]-->
    
    <link rel="stylesheet" href="/assets/app.css">
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.0";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>

<script>
  var HN=[];HN.factory=function(e){return function(){HN.push([e].concat(Array.prototype.slice.call(arguments,0)))};},HN.on=HN.factory("on"),HN.once=HN.factory("once"),HN.off=HN.factory("off"),HN.emit=HN.factory("emit"),HN.load=function(){var e="hn-button.js";if(document.getElementById(e))return;var t=document.createElement("script");t.id=e,t.src="//hn-button.herokuapp.com/hn-button.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)},HN.load();</script>
</script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-34892053-1', 'auto');
  ga('send', 'pageview');
</script>



    <link rel="shortcut icon" href="/favicon.ico?v2" type="image/x-icon" />
    <link rel="alternate" type="application/atom+xml" title="Mourad Mourafiq" href="/atom.xml" />
    <meta name="title" content="Quora Typeahead search. ">
    <link rel="canonical" href="http://mourafiq.com/2012/11/01/quora-type-ahead.html">
    <meta property="og:title" content="Quora Typeahead search."/>
    <meta property="og:url" content="http://mourafiq.com/2012/11/01/quora-type-ahead.html"/>
    <meta property="og:image" content="http://mourafiq.com/images/posts/quora.png"/>
    
    <meta property="og:description" content="Designing an algorithm to return the most relevant results that match the search query entered into the input text field."/>
    <meta name="description" content="Designing an algorithm to return the most relevant results that match the search query entered into the input text field."/>
    
    <meta property="og:site_name" content="Mourad Mourafiq">
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>

<body>

    <header class="site-header">
        <nav>
            <a class="brand" href="/">
                <img src="/images/logo.png" alt="Inc">
            </a>
            <a href="/about.html">About</a>
        </nav>
    </header>

    
<div class="cover  article-cover " style="background-image:url(/images/posts/quora.png)"></div>


<div class='cover-caption'><a href='/about.html#pictures'>Quora</a></div>


<article >
    <div class="container">
        <header>
            
            <div class="meta">
                <!--
                By
                <address><a rel="author" href="" title="Mourad Mourafiq." target="_blank">
                    Mourad Mourafiq.
                </a></address> &mdash;
                -->
                <time pubdate datetime="2012-01-November" title="Nov 01, 2012">
                    Nov 01, 2012
                </time> &mdash;
                
35 min read
            </div>
            
            <h1 class="title">Quora Typeahead search.</h1>
            <h2 class="subtitle">Designing an algorithm to return the most relevant results that match the search query entered into the input text field.</h2>
        </header>

        <section>
            <p>This is an attempt to solve the quora typeahead challenge.</p>

<p><img src="/images/posts/quora-type-ahead.png" alt="quora-typeahead-search" /></p>

<p>The search bar at the top of every page on Quora allows you to search the most up-to-date people, topics and questions on our site.</p>

<p>We want to quickly return the most relevant results that match the search query entered into the input text field.  Every time a new user, question or topic is added (or old ones deleted), subsequent queries must reflect those changes immediately.  We currently use a fast in-memory service to handle this.</p>

<p>Input comes into the service as the following commands:</p>

<ul>
  <li>**ADD <type> <id> <score> <data string="" that="" can="" contain="" spaces="">**</data></score></id></type></li>
</ul>

<p>Adds the following <type> of item (user | topic | question | board) with the unique <id> string and <score> float, corresponding to the <data string=""> that would be used to match queries.</data></score></id></type></p>

<ul>
  <li>**DEL <id>**</id></li>
</ul>

<p>Deletes the item specified by unique identifier <id>.</id></p>

<ul>
  <li>**QUERY <number of="" results=""> <query string="" that="" can="" contain="" spaces="">**</query></number></li>
</ul>

<p>Queries for the specified integer number of results (up to 20) that match a given query string.  For a data item to be considered a matching result to a query, each token in the query must be found in the data string as a case-insensitive prefix to any token in the data string. The results are ranked in descending order of score, and we only take the top few results as specified. When there is a tie in the score, newer items (more recently added) should be ranked higher.  If there are no results, just output the empty string on that line.</p>

<ul>
  <li>**WQUERY <number of="" results=""> <number of="" boosts=""> (<type>:<boost>)* (<id>:<boost>)* <query string="" that="" can="" contain="" spaces="">**</query></boost></id></boost></type></number></number></li>
</ul>

<p>Same as QUERY, except that instead of using the raw input score specified by ADD for the particular item, the scores are weighted by the optional number of boosting factors.  The boosts are floats that should be multiplied to the raw score, and affect either whole types, or specific items with the given <id>s.  If there are multiple boosts applicable, they each are multiplied commutatively to the raw score.</id></p>

<p>Your task will be to write an equivalent service as a standalone program, with input files that correspond to the queries and updates to the data, and expected output files that correspond to the results obtained for each query.</p>

<p><strong>Input format (read from STDIN)</strong>:</p>

<p>Your program will be given an integer N on the first line of stdin, followed by N lines of the form:</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">&lt;command&gt; &lt;command data&gt;</span></code></pre></div>

<table>
  <tbody>
    <tr>
      <td>The input commands are: ADD</td>
      <td>DEL</td>
      <td>QUERY</td>
      <td>WQUERY</td>
    </tr>
  </tbody>
</table>

<table>
  <tbody>
    <tr>
      <td>Types are: user</td>
      <td>topic</td>
      <td>question</td>
      <td>board</td>
    </tr>
  </tbody>
</table>

<p>Ids are alphanumeric strings without spaces or punctuation and will not include the same strings used for types.</p>

<p>Data strings can be any ASCII character, but are delimited by spaces or tabs. We will not be using anything special unprintable characters or \r and \n in the data string.</p>

<p>Command data for each command is as specified above.  For example:</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="lineno"> 1</span> <span class="go">15</span>
<span class="lineno"> 2</span> <span class="go">ADD user u1 1.0 Adam D’Angelo</span>
<span class="lineno"> 3</span> <span class="go">ADD user u2 1.0 Adam Black</span>
<span class="lineno"> 4</span> <span class="go">ADD topic t1 0.8 Adam D’Angelo</span>
<span class="lineno"> 5</span> <span class="go">ADD question q1 0.5 What does Adam D’Angelo do at Quora?</span>
<span class="lineno"> 6</span> <span class="go">ADD question q2 0.5 How did Adam D’Angelo learn programming?</span>
<span class="lineno"> 7</span> <span class="go">QUERY 10 Adam</span>
<span class="lineno"> 8</span> <span class="go">QUERY 10 Adam D’A</span>
<span class="lineno"> 9</span> <span class="go">QUERY 10 Adam Cheever</span>
<span class="lineno">10</span> <span class="go">QUERY 10 LEARN how</span>
<span class="lineno">11</span> <span class="go">QUERY 1 lear H</span>
<span class="lineno">12</span> <span class="go">QUERY 0 lea</span>
<span class="lineno">13</span> <span class="go">WQUERY 10 0 Adam D’A</span>
<span class="lineno">14</span> <span class="go">WQUERY 2 1 topic:9.99 Adam D’A</span>
<span class="lineno">15</span> <span class="go">DEL u2</span>
<span class="lineno">16</span> <span class="go">QUERY 2 Adam</span></code></pre></div>

<p><strong>Output format (write to STDOUT)</strong>:</p>

<p>For each QUERY and WQUERY command, you should output the following line:</p>

<sorted result="" ids="">

Where each line contains the <id>s in descending score order, up to the required number of results, as specified above according to the QUERY and WQUERY commands.  If there are no matches, output the empty line.  For example:


<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="lineno">1</span> <span class="go">u2 u1 t1 q2 q1</span>
<span class="lineno">2</span> <span class="go">u1 t1 q2 q1</span>
<span class="lineno">3</span> 
<span class="lineno">4</span> <span class="go">q2</span>
<span class="lineno">5</span> <span class="go">q2</span>
<span class="lineno">6</span> 
<span class="lineno">7</span> <span class="go">u1 t1 q2 q1</span>
<span class="lineno">8</span> <span class="go">t1 u1</span>
<span class="lineno">9</span> <span class="go">u1 t1</span></code></pre></div>


**Constraints**:

 * 0 &lt; N &lt; 100000
 * 0 &lt; number of ADDs &lt; 40000
 * 0 &lt; number of DELs &lt; 10000
 * 0 &lt; number of QUERYs &lt; 20000
 * 0 &lt; number of WQUERYs &lt; 1000
 * 0 &lt; number of boosts &lt; 25
 * 0.0 &lt; each score &lt; 100.0
 * 0 &lt; data string length &lt; 100 chars

You should aim to have your algorithm be fast enough to solve our largest test inputs in under 5 seconds, or be as close to that as possible.

**Notes**:

In this problem, we are presenting a representative simplified version of our service for the purposes of the contest.

##Solution:

Before we dive into the solution we need to process the entries. We can use the regular expression lib from python, to match, validate and extract informations from the inputs:


<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="lineno"> 1</span> <span class="n">COMMANDS</span> <span class="o">=</span> <span class="s">&quot;(ADD)|(DEL)|(W?QUERY)&quot;</span>
<span class="lineno"> 2</span> <span class="n">ANY_STRING</span> <span class="o">=</span> <span class="s">&quot;(</span><span class="se">\\</span><span class="s">S*.*)&quot;</span>
<span class="lineno"> 3</span> <span class="n">SEPARATORS</span> <span class="o">=</span> <span class="s">&quot;(?: |</span><span class="se">\\</span><span class="s">t)&quot;</span>
<span class="lineno"> 4</span> <span class="n">IDS</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">w+&quot;</span>
<span class="lineno"> 5</span> <span class="n">TYPES</span> <span class="o">=</span> <span class="s">&quot;user|topic|question|board&quot;</span>
<span class="lineno"> 6</span> <span class="n">FLOATS</span> <span class="o">=</span> <span class="s">&quot;[0-9]+(?:.[0-9]*)?&quot;</span>
<span class="lineno"> 7</span> <span class="n">INTS</span> <span class="o">=</span> <span class="s">&quot;[0-9]+&quot;</span>
<span class="lineno"> 8</span> <span class="n">BOOSTS</span> <span class="o">=</span> <span class="s">&quot;((?:&quot;</span> <span class="o">+</span> <span class="n">TYPES</span> <span class="o">+</span> <span class="s">&quot;|(?:&quot;</span> <span class="o">+</span> <span class="n">IDS</span> <span class="o">+</span> <span class="s">&quot;)):&quot;</span> <span class="o">+</span> <span class="n">FLOATS</span> <span class="o">+</span> <span class="n">SEPARATORS</span> <span class="o">+</span> <span class="s">&quot;)*&quot;</span>
<span class="lineno"> 9</span> <span class="n">ANY_COMMAND</span> <span class="o">=</span> <span class="s">&quot;(?P&lt;command&gt;&quot;</span> <span class="o">+</span> <span class="n">COMMANDS</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span> <span class="o">+</span> <span class="n">SEPARATORS</span> <span class="o">+</span> <span class="s">&quot;(?P&lt;parameters&gt;&quot;</span> <span class="o">+</span> <span class="n">ANY_STRING</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
<span class="lineno">10</span> <span class="n">ADD_COMMAND</span> <span class="o">=</span> <span class="s">&quot;(?P&lt;type&gt;&quot;</span> <span class="o">+</span> <span class="n">TYPES</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span> <span class="o">+</span> <span class="n">SEPARATORS</span> <span class="o">+</span> \
<span class="lineno">11</span>                 <span class="s">&quot;(?P&lt;id&gt;&quot;</span> <span class="o">+</span> <span class="n">IDS</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span> <span class="o">+</span> <span class="n">SEPARATORS</span> <span class="o">+</span> \
<span class="lineno">12</span>                 <span class="s">&quot;(?P&lt;score&gt;&quot;</span> <span class="o">+</span> <span class="n">FLOATS</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span> <span class="o">+</span> <span class="n">SEPARATORS</span> <span class="o">+</span> \
<span class="lineno">13</span>                 <span class="s">&quot;(?P&lt;content&gt;&quot;</span> <span class="o">+</span> <span class="n">ANY_STRING</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
<span class="lineno">14</span> <span class="n">DEL_COMMAND</span> <span class="o">=</span> <span class="s">&quot;(?P&lt;id&gt;&quot;</span> <span class="o">+</span> <span class="n">IDS</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
<span class="lineno">15</span> <span class="n">QUERY_COMMAND</span> <span class="o">=</span> <span class="s">&quot;(?P&lt;nbr_results&gt;&quot;</span> <span class="o">+</span> <span class="n">INTS</span> <span class="o">+</span><span class="s">&quot;)&quot;</span> <span class="o">+</span> <span class="n">SEPARATORS</span> <span class="o">+</span> \
<span class="lineno">16</span>                 <span class="s">&quot;(?P&lt;query&gt;&quot;</span> <span class="o">+</span> <span class="n">ANY_STRING</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
<span class="lineno">17</span> <span class="n">WQUERY_COMMAND</span> <span class="o">=</span> <span class="s">&quot;(?P&lt;nbr_results&gt;&quot;</span> <span class="o">+</span> <span class="n">INTS</span> <span class="o">+</span><span class="s">&quot;)&quot;</span> <span class="o">+</span> <span class="n">SEPARATORS</span> <span class="o">+</span> \
<span class="lineno">18</span>                  <span class="s">&quot;(?P&lt;nbr_boosts&gt;&quot;</span> <span class="o">+</span> <span class="n">INTS</span> <span class="o">+</span><span class="s">&quot;)&quot;</span> <span class="o">+</span> <span class="n">SEPARATORS</span> <span class="o">+</span> \
<span class="lineno">19</span>                  <span class="s">&quot;(?P&lt;boosts&gt;&quot;</span> <span class="o">+</span> <span class="n">BOOSTS</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span> <span class="o">+</span> \
<span class="lineno">20</span>                  <span class="s">&quot;(?P&lt;query&gt;&quot;</span> <span class="o">+</span><span class="n">ANY_STRING</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
<span class="lineno">21</span> <span class="n">COMMAND_MATCHER</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">ANY_COMMAND</span><span class="p">)</span>
<span class="lineno">22</span> <span class="n">ADD_COMMAND_MATCHER</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">ADD_COMMAND</span><span class="p">)</span>
<span class="lineno">23</span> <span class="n">DEL_COMMAND_MATCHER</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">DEL_COMMAND</span><span class="p">)</span>
<span class="lineno">24</span> <span class="n">QUERY_COMMAND_MATCHER</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">QUERY_COMMAND</span><span class="p">)</span>
<span class="lineno">25</span> <span class="n">WQUERY_COMMAND_MATCHER</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">WQUERY_COMMAND</span><span class="p">)</span></code></pre></div>


So, now that we are able to process inputs, we can move to the next phase, modelling the items:


<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="lineno"> 1</span> <span class="k">class</span> <span class="nc">Item</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="lineno"> 2</span>     <span class="sd">&quot;&quot;&quot;</span>
<span class="lineno"> 3</span> <span class="sd">    either a topic, a user, a board or a question</span>
<span class="lineno"> 4</span> 
<span class="lineno"> 5</span> <span class="sd">    @type type: str</span>
<span class="lineno"> 6</span> <span class="sd">    @param type: The item&#39;s type.</span>
<span class="lineno"> 7</span> 
<span class="lineno"> 8</span> <span class="sd">    @type id: str</span>
<span class="lineno"> 9</span> <span class="sd">    @param id: The item&#39;s id.</span>
<span class="lineno">10</span> 
<span class="lineno">11</span> <span class="sd">    @type score: float</span>
<span class="lineno">12</span> <span class="sd">    @param score: The item&#39;s score.</span>
<span class="lineno">13</span> 
<span class="lineno">14</span> <span class="sd">    @type content: str</span>
<span class="lineno">15</span> <span class="sd">    @param contetn: The item&#39;s content.</span>
<span class="lineno">16</span> 
<span class="lineno">17</span> <span class="sd">    @type time: time</span>
<span class="lineno">18</span> <span class="sd">    @param time: The item&#39;s time of creation.</span>
<span class="lineno">19</span> <span class="sd">    &quot;&quot;&quot;</span>
<span class="lineno">20</span> 
<span class="lineno">21</span>     <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
<span class="lineno">22</span>         <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
<span class="lineno">23</span>         <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
<span class="lineno">24</span>         <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
<span class="lineno">25</span>         <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span>
<span class="lineno">26</span>         <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="lineno">27</span> 
<span class="lineno">28</span>     <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno">29</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
<span class="lineno">30</span> 
<span class="lineno">31</span>     <span class="k">def</span> <span class="nf">better_than</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="lineno">32</span>         <span class="sd">&quot;&quot;&quot;</span>
<span class="lineno">33</span> <span class="sd">        compare the current item to the input item.</span>
<span class="lineno">34</span> <span class="sd">        follows this method:</span>
<span class="lineno">35</span> <span class="sd">            . highest score goes first.</span>
<span class="lineno">36</span> <span class="sd">            . same score; time FIFO.</span>
<span class="lineno">37</span> <span class="sd">        return true if the current item is better than the input, otherwise returns false</span>
<span class="lineno">38</span> <span class="sd">        &quot;&quot;&quot;</span>
<span class="lineno">39</span>         <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">&gt;</span> <span class="n">item</span><span class="o">.</span><span class="n">score</span><span class="p">):</span>
<span class="lineno">40</span>             <span class="k">return</span> <span class="bp">True</span>
<span class="lineno">41</span>         <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">&lt;</span> <span class="n">item</span><span class="o">.</span><span class="n">score</span><span class="p">):</span>
<span class="lineno">42</span>             <span class="k">return</span> <span class="bp">False</span>
<span class="lineno">43</span>         <span class="k">return</span> <span class="bp">True</span> <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;</span> <span class="n">item</span><span class="o">.</span><span class="n">time</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span></code></pre></div>


Our solution should provide 4 services adding, deleting, querying and w-querying. And since we are dealing with strings as entries, we need a data structure that is practical for inserting and retrieving. The radix trees seems like a good choice and are practical in this kind of situations.


<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="lineno">  1</span> <span class="k">class</span> <span class="nc">Prefixer</span><span class="p">():</span>
<span class="lineno">  2</span> 
<span class="lineno">  3</span>     <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno">  4</span>         <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="p">{}</span>
<span class="lineno">  5</span> 
<span class="lineno">  6</span>     <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno">  7</span>         <span class="k">return</span> <span class="s">&#39;Prefixer(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">,)</span>
<span class="lineno">  8</span> 
<span class="lineno">  9</span>     <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="lineno"> 10</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">__data</span>
<span class="lineno"> 11</span> 
<span class="lineno"> 12</span>     <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno"> 13</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
<span class="lineno"> 14</span> 
<span class="lineno"> 15</span>     <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">item_id</span><span class="p">):</span>
<span class="lineno"> 16</span>         <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
<span class="lineno"> 17</span>         <span class="k">while</span> <span class="n">word</span><span class="p">:</span>
<span class="lineno"> 18</span>             <span class="n">prefix</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">longest_prefix</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="lineno"> 19</span>             <span class="k">if</span> <span class="ow">not</span> <span class="n">prefix</span><span class="p">:</span>
<span class="lineno"> 20</span>                 <span class="k">break</span>
<span class="lineno"> 21</span>             <span class="n">len_prefix</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
<span class="lineno"> 22</span>             <span class="k">if</span> <span class="n">prefix</span> <span class="o">!=</span> <span class="n">key</span><span class="p">:</span>
<span class="lineno"> 23</span>                 <span class="c"># split key into prefix:suffix, move data</span>
<span class="lineno"> 24</span>                 <span class="n">suffix</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="n">len_prefix</span><span class="p">:]</span>
<span class="lineno"> 25</span>                 <span class="n">current_node</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<span class="lineno"> 26</span>                 <span class="n">node</span><span class="p">[</span><span class="n">prefix</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">suffix</span><span class="p">:</span><span class="n">current_node</span><span class="p">}</span>
<span class="lineno"> 27</span>                 <span class="k">del</span> <span class="n">node</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<span class="lineno"> 28</span>             <span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="n">len_prefix</span><span class="p">:]</span>
<span class="lineno"> 29</span>             <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">prefix</span><span class="p">]</span>
<span class="lineno"> 30</span>         <span class="k">if</span> <span class="n">word</span><span class="p">:</span>
<span class="lineno"> 31</span>             <span class="n">node</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">NOK</span><span class="p">)</span>
<span class="lineno"> 32</span>             <span class="n">node</span><span class="p">[</span><span class="n">word</span><span class="p">][</span><span class="s">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item_id</span><span class="p">)</span>
<span class="lineno"> 33</span>         <span class="k">else</span><span class="p">:</span>
<span class="lineno"> 34</span>             <span class="k">try</span><span class="p">:</span>
<span class="lineno"> 35</span>                 <span class="n">node</span><span class="p">[</span><span class="n">word</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item_id</span><span class="p">)</span>
<span class="lineno"> 36</span>             <span class="k">except</span><span class="p">:</span>
<span class="lineno"> 37</span>                 <span class="n">node</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="lineno"> 38</span>                 <span class="n">node</span><span class="p">[</span><span class="n">word</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item_id</span><span class="p">)</span>
<span class="lineno"> 39</span>         <span class="k">return</span> <span class="bp">True</span>
<span class="lineno"> 40</span> 
<span class="lineno"> 41</span>     <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">item_id</span><span class="p">):</span>
<span class="lineno"> 42</span>         <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
<span class="lineno"> 43</span>         <span class="k">while</span> <span class="n">word</span><span class="p">:</span>
<span class="lineno"> 44</span>             <span class="n">prefix</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">longest_prefix</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="lineno"> 45</span>             <span class="k">if</span> <span class="ow">not</span> <span class="n">prefix</span><span class="p">:</span>
<span class="lineno"> 46</span>                 <span class="k">return</span> <span class="bp">False</span>
<span class="lineno"> 47</span>             <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<span class="lineno"> 48</span>             <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="p">:</span>
<span class="lineno"> 49</span>                 <span class="k">return</span> <span class="bp">False</span>
<span class="lineno"> 50</span>             <span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">):]</span>
<span class="lineno"> 51</span>         <span class="k">try</span><span class="p">:</span>
<span class="lineno"> 52</span>             <span class="n">node</span><span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item_id</span><span class="p">)</span>
<span class="lineno"> 53</span>             <span class="k">return</span> <span class="bp">True</span>
<span class="lineno"> 54</span>         <span class="k">except</span><span class="p">:</span>
<span class="lineno"> 55</span>             <span class="k">return</span> <span class="bp">False</span>
<span class="lineno"> 56</span> 
<span class="lineno"> 57</span>     <span class="k">def</span> <span class="nf">_search_dico</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
<span class="lineno"> 58</span>         <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
<span class="lineno"> 59</span>         <span class="k">while</span> <span class="n">word</span><span class="p">:</span>
<span class="lineno"> 60</span>             <span class="n">prefix</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">longest_prefix</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="lineno"> 61</span>             <span class="k">if</span> <span class="ow">not</span> <span class="n">prefix</span><span class="p">:</span>
<span class="lineno"> 62</span>                 <span class="k">return</span> <span class="bp">False</span>
<span class="lineno"> 63</span>             <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="p">:</span>
<span class="lineno"> 64</span>                 <span class="k">return</span> <span class="bp">False</span>
<span class="lineno"> 65</span>             <span class="k">if</span> <span class="n">prefix</span> <span class="o">!=</span> <span class="n">key</span><span class="p">:</span>
<span class="lineno"> 66</span>                 <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="n">word</span><span class="p">:</span>
<span class="lineno"> 67</span>                     <span class="k">return</span> <span class="n">node</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<span class="lineno"> 68</span>                 <span class="k">else</span><span class="p">:</span>
<span class="lineno"> 69</span>                     <span class="k">return</span> <span class="bp">False</span>
<span class="lineno"> 70</span>             <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">prefix</span><span class="p">]</span>
<span class="lineno"> 71</span>             <span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">):]</span>
<span class="lineno"> 72</span>         <span class="k">return</span> <span class="n">node</span>
<span class="lineno"> 73</span> 
<span class="lineno"> 74</span>     <span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
<span class="lineno"> 75</span>         <span class="n">dico</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_dico</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
<span class="lineno"> 76</span>         <span class="k">if</span> <span class="n">dico</span> <span class="o">!=</span> <span class="bp">False</span><span class="p">:</span>
<span class="lineno"> 77</span>             <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">traverse_dico</span><span class="p">(</span><span class="n">dico</span><span class="p">)</span>
<span class="lineno"> 78</span>         <span class="k">return</span> <span class="p">[]</span>
<span class="lineno"> 79</span> 
<span class="lineno"> 80</span>     <span class="nd">@staticmethod</span>  
<span class="lineno"> 81</span>     <span class="k">def</span> <span class="nf">traverse_dico</span><span class="p">(</span><span class="n">dico</span><span class="p">):</span>
<span class="lineno"> 82</span>         <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="lineno"> 83</span>         <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dico</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
<span class="lineno"> 84</span>             <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
<span class="lineno"> 85</span>                 <span class="n">results</span> <span class="o">+=</span> <span class="n">value</span>
<span class="lineno"> 86</span>             <span class="k">else</span><span class="p">:</span>
<span class="lineno"> 87</span>                 <span class="n">results</span> <span class="o">+=</span> <span class="n">Prefixer</span><span class="o">.</span><span class="n">traverse_dico</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<span class="lineno"> 88</span>         <span class="k">return</span> <span class="n">results</span>
<span class="lineno"> 89</span> 
<span class="lineno"> 90</span>     <span class="nd">@staticmethod</span>
<span class="lineno"> 91</span>     <span class="k">def</span> <span class="nf">longest_prefix</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">candidates</span><span class="p">):</span>
<span class="lineno"> 92</span>         <span class="sd">&quot;&quot;&quot;</span>
<span class="lineno"> 93</span> <span class="sd">        return the longest prefix match between word and any of the</span>
<span class="lineno"> 94</span> <span class="sd">        candidates, if any. Only one candidate will much.</span>
<span class="lineno"> 95</span> <span class="sd">        &quot;&quot;&quot;</span>
<span class="lineno"> 96</span>         <span class="k">if</span> <span class="n">word</span><span class="p">:</span>
<span class="lineno"> 97</span>             <span class="n">wc</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="lineno"> 98</span>             <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
<span class="lineno"> 99</span>                 <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">wc</span><span class="p">):</span>
<span class="lineno">100</span>                     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">)):</span>
<span class="lineno">101</span>                         <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">word</span><span class="p">[:</span><span class="n">i</span><span class="p">]):</span>
<span class="lineno">102</span>                             <span class="k">return</span> <span class="p">(</span><span class="n">word</span><span class="p">[:</span><span class="n">i</span><span class="p">],</span> <span class="n">c</span><span class="p">)</span>
<span class="lineno">103</span>         <span class="k">return</span> <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span></code></pre></div>


Finally, we put all this together:


<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="lineno">  1</span> <span class="c"># -*- coding: utf-8 -*-</span>
<span class="lineno">  2</span> <span class="sd">&#39;&#39;&#39;</span>
<span class="lineno">  3</span> <span class="sd">Created on Jan 04, 2013</span>
<span class="lineno">  4</span> 
<span class="lineno">  5</span> <span class="sd">@author: Mourad Mourafiq</span>
<span class="lineno">  6</span> 
<span class="lineno">  7</span> <span class="sd">About: This is an attempt to solve the Quora challenge Typehead.</span>
<span class="lineno">  8</span> <span class="sd">&#39;&#39;&#39;</span>
<span class="lineno">  9</span> <span class="kn">import</span> <span class="nn">re</span>
<span class="lineno"> 10</span> <span class="kn">import</span> <span class="nn">copy</span>
<span class="lineno"> 11</span> <span class="kn">import</span> <span class="nn">datetime</span>
<span class="lineno"> 12</span> 
<span class="lineno"> 13</span> <span class="n">COMMANDS</span> <span class="o">=</span> <span class="s">&quot;(ADD)|(DEL)|(W?QUERY)&quot;</span>
<span class="lineno"> 14</span> <span class="n">ANY_STRING</span> <span class="o">=</span> <span class="s">&quot;(</span><span class="se">\\</span><span class="s">S*.*)&quot;</span>
<span class="lineno"> 15</span> <span class="n">SEPARATORS</span> <span class="o">=</span> <span class="s">&quot;(?: |</span><span class="se">\\</span><span class="s">t)&quot;</span>
<span class="lineno"> 16</span> <span class="n">IDS</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">w+&quot;</span>
<span class="lineno"> 17</span> <span class="n">TYPES</span> <span class="o">=</span> <span class="s">&quot;user|topic|question|board&quot;</span>
<span class="lineno"> 18</span> <span class="n">FLOATS</span> <span class="o">=</span> <span class="s">&quot;[0-9]+(?:.[0-9]*)?&quot;</span>
<span class="lineno"> 19</span> <span class="n">INTS</span> <span class="o">=</span> <span class="s">&quot;[0-9]+&quot;</span>
<span class="lineno"> 20</span> <span class="n">BOOSTS</span> <span class="o">=</span> <span class="s">&quot;((?:&quot;</span> <span class="o">+</span> <span class="n">TYPES</span> <span class="o">+</span> <span class="s">&quot;|(?:&quot;</span> <span class="o">+</span> <span class="n">IDS</span> <span class="o">+</span> <span class="s">&quot;)):&quot;</span> <span class="o">+</span> <span class="n">FLOATS</span> <span class="o">+</span> <span class="n">SEPARATORS</span> <span class="o">+</span> <span class="s">&quot;)*&quot;</span>
<span class="lineno"> 21</span> <span class="n">ANY_COMMAND</span> <span class="o">=</span> <span class="s">&quot;(?P&lt;command&gt;&quot;</span> <span class="o">+</span> <span class="n">COMMANDS</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span> <span class="o">+</span> <span class="n">SEPARATORS</span> <span class="o">+</span> <span class="s">&quot;(?P&lt;parameters&gt;&quot;</span> <span class="o">+</span> <span class="n">ANY_STRING</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
<span class="lineno"> 22</span> <span class="n">ADD_COMMAND</span> <span class="o">=</span> <span class="s">&quot;(?P&lt;type&gt;&quot;</span> <span class="o">+</span> <span class="n">TYPES</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span> <span class="o">+</span> <span class="n">SEPARATORS</span> <span class="o">+</span> \
<span class="lineno"> 23</span>                 <span class="s">&quot;(?P&lt;id&gt;&quot;</span> <span class="o">+</span> <span class="n">IDS</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span> <span class="o">+</span> <span class="n">SEPARATORS</span> <span class="o">+</span> \
<span class="lineno"> 24</span>                 <span class="s">&quot;(?P&lt;score&gt;&quot;</span> <span class="o">+</span> <span class="n">FLOATS</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span> <span class="o">+</span> <span class="n">SEPARATORS</span> <span class="o">+</span> \
<span class="lineno"> 25</span>                 <span class="s">&quot;(?P&lt;content&gt;&quot;</span> <span class="o">+</span> <span class="n">ANY_STRING</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
<span class="lineno"> 26</span> <span class="n">DEL_COMMAND</span> <span class="o">=</span> <span class="s">&quot;(?P&lt;id&gt;&quot;</span> <span class="o">+</span> <span class="n">IDS</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
<span class="lineno"> 27</span> <span class="n">QUERY_COMMAND</span> <span class="o">=</span> <span class="s">&quot;(?P&lt;nbr_results&gt;&quot;</span> <span class="o">+</span> <span class="n">INTS</span> <span class="o">+</span><span class="s">&quot;)&quot;</span> <span class="o">+</span> <span class="n">SEPARATORS</span> <span class="o">+</span> \
<span class="lineno"> 28</span>                 <span class="s">&quot;(?P&lt;query&gt;&quot;</span> <span class="o">+</span> <span class="n">ANY_STRING</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
<span class="lineno"> 29</span> <span class="n">WQUERY_COMMAND</span> <span class="o">=</span> <span class="s">&quot;(?P&lt;nbr_results&gt;&quot;</span> <span class="o">+</span> <span class="n">INTS</span> <span class="o">+</span><span class="s">&quot;)&quot;</span> <span class="o">+</span> <span class="n">SEPARATORS</span> <span class="o">+</span> \
<span class="lineno"> 30</span>                  <span class="s">&quot;(?P&lt;nbr_boosts&gt;&quot;</span> <span class="o">+</span> <span class="n">INTS</span> <span class="o">+</span><span class="s">&quot;)&quot;</span> <span class="o">+</span> <span class="n">SEPARATORS</span> <span class="o">+</span> \
<span class="lineno"> 31</span>                  <span class="s">&quot;(?P&lt;boosts&gt;&quot;</span> <span class="o">+</span> <span class="n">BOOSTS</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span> <span class="o">+</span> \
<span class="lineno"> 32</span>                  <span class="s">&quot;(?P&lt;query&gt;&quot;</span> <span class="o">+</span><span class="n">ANY_STRING</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
<span class="lineno"> 33</span> <span class="n">COMMAND_MATCHER</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">ANY_COMMAND</span><span class="p">)</span>
<span class="lineno"> 34</span> <span class="n">ADD_COMMAND_MATCHER</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">ADD_COMMAND</span><span class="p">)</span>
<span class="lineno"> 35</span> <span class="n">DEL_COMMAND_MATCHER</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">DEL_COMMAND</span><span class="p">)</span>
<span class="lineno"> 36</span> <span class="n">QUERY_COMMAND_MATCHER</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">QUERY_COMMAND</span><span class="p">)</span>
<span class="lineno"> 37</span> <span class="n">WQUERY_COMMAND_MATCHER</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">WQUERY_COMMAND</span><span class="p">)</span>
<span class="lineno"> 38</span> 
<span class="lineno"> 39</span> <span class="n">NOK</span> <span class="o">=</span> <span class="s">&quot;{&#39;&#39;:[]}&quot;</span>
<span class="lineno"> 40</span> 
<span class="lineno"> 41</span> <span class="k">class</span> <span class="nc">Prefixer</span><span class="p">():</span>
<span class="lineno"> 42</span> 
<span class="lineno"> 43</span>     <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno"> 44</span>         <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="p">{}</span>
<span class="lineno"> 45</span> 
<span class="lineno"> 46</span>     <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno"> 47</span>         <span class="k">return</span> <span class="s">&#39;Prefixer(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">,)</span>
<span class="lineno"> 48</span> 
<span class="lineno"> 49</span>     <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="lineno"> 50</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">__data</span>
<span class="lineno"> 51</span> 
<span class="lineno"> 52</span>     <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno"> 53</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
<span class="lineno"> 54</span> 
<span class="lineno"> 55</span>     <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">item_id</span><span class="p">):</span>
<span class="lineno"> 56</span>         <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
<span class="lineno"> 57</span>         <span class="k">while</span> <span class="n">word</span><span class="p">:</span>
<span class="lineno"> 58</span>             <span class="n">prefix</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">longest_prefix</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="lineno"> 59</span>             <span class="k">if</span> <span class="ow">not</span> <span class="n">prefix</span><span class="p">:</span>
<span class="lineno"> 60</span>                 <span class="k">break</span>
<span class="lineno"> 61</span>             <span class="n">len_prefix</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
<span class="lineno"> 62</span>             <span class="k">if</span> <span class="n">prefix</span> <span class="o">!=</span> <span class="n">key</span><span class="p">:</span>
<span class="lineno"> 63</span>                 <span class="c"># split key into prefix:suffix, move data</span>
<span class="lineno"> 64</span>                 <span class="n">suffix</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="n">len_prefix</span><span class="p">:]</span>
<span class="lineno"> 65</span>                 <span class="n">current_node</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<span class="lineno"> 66</span>                 <span class="n">node</span><span class="p">[</span><span class="n">prefix</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">suffix</span><span class="p">:</span><span class="n">current_node</span><span class="p">}</span>
<span class="lineno"> 67</span>                 <span class="k">del</span> <span class="n">node</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<span class="lineno"> 68</span>             <span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="n">len_prefix</span><span class="p">:]</span>
<span class="lineno"> 69</span>             <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">prefix</span><span class="p">]</span>
<span class="lineno"> 70</span>         <span class="k">if</span> <span class="n">word</span><span class="p">:</span>
<span class="lineno"> 71</span>             <span class="n">node</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">NOK</span><span class="p">)</span>
<span class="lineno"> 72</span>             <span class="n">node</span><span class="p">[</span><span class="n">word</span><span class="p">][</span><span class="s">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item_id</span><span class="p">)</span>
<span class="lineno"> 73</span>         <span class="k">else</span><span class="p">:</span>
<span class="lineno"> 74</span>             <span class="k">try</span><span class="p">:</span>
<span class="lineno"> 75</span>                 <span class="n">node</span><span class="p">[</span><span class="n">word</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item_id</span><span class="p">)</span>
<span class="lineno"> 76</span>             <span class="k">except</span><span class="p">:</span>
<span class="lineno"> 77</span>                 <span class="n">node</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="lineno"> 78</span>                 <span class="n">node</span><span class="p">[</span><span class="n">word</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item_id</span><span class="p">)</span>
<span class="lineno"> 79</span>         <span class="k">return</span> <span class="bp">True</span>
<span class="lineno"> 80</span> 
<span class="lineno"> 81</span>     <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">item_id</span><span class="p">):</span>
<span class="lineno"> 82</span>         <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
<span class="lineno"> 83</span>         <span class="k">while</span> <span class="n">word</span><span class="p">:</span>
<span class="lineno"> 84</span>             <span class="n">prefix</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">longest_prefix</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="lineno"> 85</span>             <span class="k">if</span> <span class="ow">not</span> <span class="n">prefix</span><span class="p">:</span>
<span class="lineno"> 86</span>                 <span class="k">return</span> <span class="bp">False</span>
<span class="lineno"> 87</span>             <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<span class="lineno"> 88</span>             <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="p">:</span>
<span class="lineno"> 89</span>                 <span class="k">return</span> <span class="bp">False</span>
<span class="lineno"> 90</span>             <span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">):]</span>
<span class="lineno"> 91</span>         <span class="k">try</span><span class="p">:</span>
<span class="lineno"> 92</span>             <span class="n">node</span><span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item_id</span><span class="p">)</span>
<span class="lineno"> 93</span>             <span class="k">return</span> <span class="bp">True</span>
<span class="lineno"> 94</span>         <span class="k">except</span><span class="p">:</span>
<span class="lineno"> 95</span>             <span class="k">return</span> <span class="bp">False</span>
<span class="lineno"> 96</span> 
<span class="lineno"> 97</span>     <span class="k">def</span> <span class="nf">_search_dico</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
<span class="lineno"> 98</span>         <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
<span class="lineno"> 99</span>         <span class="k">while</span> <span class="n">word</span><span class="p">:</span>
<span class="lineno">100</span>             <span class="n">prefix</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">longest_prefix</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="lineno">101</span>             <span class="k">if</span> <span class="ow">not</span> <span class="n">prefix</span><span class="p">:</span>
<span class="lineno">102</span>                 <span class="k">return</span> <span class="bp">False</span>
<span class="lineno">103</span>             <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="p">:</span>
<span class="lineno">104</span>                 <span class="k">return</span> <span class="bp">False</span>
<span class="lineno">105</span>             <span class="k">if</span> <span class="n">prefix</span> <span class="o">!=</span> <span class="n">key</span><span class="p">:</span>
<span class="lineno">106</span>                 <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="n">word</span><span class="p">:</span>
<span class="lineno">107</span>                     <span class="k">return</span> <span class="n">node</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<span class="lineno">108</span>                 <span class="k">else</span><span class="p">:</span>
<span class="lineno">109</span>                     <span class="k">return</span> <span class="bp">False</span>
<span class="lineno">110</span>             <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">prefix</span><span class="p">]</span>
<span class="lineno">111</span>             <span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">):]</span>
<span class="lineno">112</span>         <span class="k">return</span> <span class="n">node</span>
<span class="lineno">113</span> 
<span class="lineno">114</span>     <span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
<span class="lineno">115</span>         <span class="n">dico</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_dico</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
<span class="lineno">116</span>         <span class="k">if</span> <span class="n">dico</span> <span class="o">!=</span> <span class="bp">False</span><span class="p">:</span>
<span class="lineno">117</span>             <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">traverse_dico</span><span class="p">(</span><span class="n">dico</span><span class="p">)</span>
<span class="lineno">118</span>         <span class="k">return</span> <span class="p">[]</span>
<span class="lineno">119</span> 
<span class="lineno">120</span>     <span class="nd">@staticmethod</span>  
<span class="lineno">121</span>     <span class="k">def</span> <span class="nf">traverse_dico</span><span class="p">(</span><span class="n">dico</span><span class="p">):</span>
<span class="lineno">122</span>         <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="lineno">123</span>         <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dico</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
<span class="lineno">124</span>             <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
<span class="lineno">125</span>                 <span class="n">results</span> <span class="o">+=</span> <span class="n">value</span>
<span class="lineno">126</span>             <span class="k">else</span><span class="p">:</span>
<span class="lineno">127</span>                 <span class="n">results</span> <span class="o">+=</span> <span class="n">Prefixer</span><span class="o">.</span><span class="n">traverse_dico</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<span class="lineno">128</span>         <span class="k">return</span> <span class="n">results</span>
<span class="lineno">129</span> 
<span class="lineno">130</span>     <span class="nd">@staticmethod</span>
<span class="lineno">131</span>     <span class="k">def</span> <span class="nf">longest_prefix</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">candidates</span><span class="p">):</span>
<span class="lineno">132</span>         <span class="sd">&quot;&quot;&quot;</span>
<span class="lineno">133</span> <span class="sd">        return the longest prefix match between word and any of the</span>
<span class="lineno">134</span> <span class="sd">        candidates, if any. Only one candidate will much.</span>
<span class="lineno">135</span> <span class="sd">        &quot;&quot;&quot;</span>
<span class="lineno">136</span>         <span class="k">if</span> <span class="n">word</span><span class="p">:</span>
<span class="lineno">137</span>             <span class="n">wc</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="lineno">138</span>             <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
<span class="lineno">139</span>                 <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">wc</span><span class="p">):</span>
<span class="lineno">140</span>                     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">)):</span>
<span class="lineno">141</span>                         <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">word</span><span class="p">[:</span><span class="n">i</span><span class="p">]):</span>
<span class="lineno">142</span>                             <span class="k">return</span> <span class="p">(</span><span class="n">word</span><span class="p">[:</span><span class="n">i</span><span class="p">],</span> <span class="n">c</span><span class="p">)</span>
<span class="lineno">143</span>         <span class="k">return</span> <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<span class="lineno">144</span> 
<span class="lineno">145</span> 
<span class="lineno">146</span> <span class="k">class</span> <span class="nc">TypeHead</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="lineno">147</span>     <span class="sd">&quot;&quot;&quot;</span>
<span class="lineno">148</span> <span class="sd">    typehead object that manages all items</span>
<span class="lineno">149</span> 
<span class="lineno">150</span> <span class="sd">    @type items: dict</span>
<span class="lineno">151</span> <span class="sd">    @param items: dict of {id : item}</span>
<span class="lineno">152</span> <span class="sd">    &quot;&quot;&quot;</span>
<span class="lineno">153</span> 
<span class="lineno">154</span>     <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno">155</span>         <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{}</span>
<span class="lineno">156</span>         <span class="bp">self</span><span class="o">.</span><span class="n">prefixer</span> <span class="o">=</span> <span class="n">Prefixer</span><span class="p">()</span>
<span class="lineno">157</span> 
<span class="lineno">158</span>     <span class="k">def</span> <span class="nf">_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="lineno">159</span>         <span class="n">item_id</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">id</span>
<span class="lineno">160</span>         <span class="n">item_content</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">content</span>
<span class="lineno">161</span>         <span class="c">#add item to the dict</span>
<span class="lineno">162</span>         <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">item_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
<span class="lineno">163</span>         <span class="n">tokens</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">SEPARATORS</span><span class="p">,</span> <span class="n">item_content</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
<span class="lineno">164</span>         <span class="c">#add tokens to the prefixer</span>
<span class="lineno">165</span>         <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
<span class="lineno">166</span>             <span class="bp">self</span><span class="o">.</span><span class="n">prefixer</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">item_id</span><span class="p">)</span>
<span class="lineno">167</span> 
<span class="lineno">168</span>     <span class="k">def</span> <span class="nf">_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item_id</span><span class="p">):</span>
<span class="lineno">169</span>         <span class="n">item_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">item_id</span><span class="p">]</span><span class="o">.</span><span class="n">content</span>
<span class="lineno">170</span>         <span class="c">#delete the item from the dict</span>
<span class="lineno">171</span>         <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">item_id</span><span class="p">]</span>
<span class="lineno">172</span>         <span class="n">tokens</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">SEPARATORS</span><span class="p">,</span> <span class="n">item_content</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
<span class="lineno">173</span>         <span class="c">#remove items from the prefixer for each token</span>
<span class="lineno">174</span>         <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
<span class="lineno">175</span>             <span class="bp">self</span><span class="o">.</span><span class="n">prefixer</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">item_id</span><span class="p">)</span>
<span class="lineno">176</span> 
<span class="lineno">177</span>     <span class="k">def</span> <span class="nf">_set_items_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
<span class="lineno">178</span>         <span class="n">items_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="lineno">179</span>         <span class="n">tokens</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">SEPARATORS</span><span class="p">,</span> <span class="n">query</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
<span class="lineno">180</span>         <span class="n">cpt</span> <span class="o">=</span> <span class="bp">True</span>
<span class="lineno">181</span>         <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
<span class="lineno">182</span>             <span class="k">if</span> <span class="n">cpt</span><span class="p">:</span>
<span class="lineno">183</span>                 <span class="n">items_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefixer</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">token</span><span class="p">))</span>
<span class="lineno">184</span>             <span class="k">else</span><span class="p">:</span>
<span class="lineno">185</span>                 <span class="n">items_ids</span> <span class="o">=</span> <span class="n">items_ids</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefixer</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">token</span><span class="p">)))</span>
<span class="lineno">186</span>             <span class="k">if</span> <span class="n">items_ids</span> <span class="o">==</span> <span class="nb">set</span><span class="p">():</span>
<span class="lineno">187</span>                 <span class="k">return</span> <span class="n">items_ids</span>
<span class="lineno">188</span>             <span class="n">cpt</span> <span class="o">=</span> <span class="bp">False</span>
<span class="lineno">189</span>         <span class="k">return</span> <span class="n">items_ids</span>
<span class="lineno">190</span> 
<span class="lineno">191</span> 
<span class="lineno">192</span>     <span class="k">def</span> <span class="nf">_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nbr_results</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
<span class="lineno">193</span>         <span class="c">#collect potential items&#39; ids</span>
<span class="lineno">194</span>         <span class="n">items_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_items_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="lineno">195</span>         <span class="c">#check if items_ids is not empty</span>
<span class="lineno">196</span>         <span class="k">if</span> <span class="n">items_ids</span> <span class="o">==</span> <span class="nb">set</span><span class="p">():</span>
<span class="lineno">197</span>             <span class="k">return</span> <span class="s">&quot;&quot;</span>
<span class="lineno">198</span>         <span class="c">#rank them according to the scoring method</span>
<span class="lineno">199</span>         <span class="n">sorted_results</span> <span class="o">=</span> <span class="n">SortedItems</span><span class="p">(</span><span class="n">nbr_results</span><span class="p">)</span>
<span class="lineno">200</span>         <span class="k">for</span> <span class="n">item_id</span> <span class="ow">in</span> <span class="n">items_ids</span><span class="p">:</span>
<span class="lineno">201</span>             <span class="n">sorted_results</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">item_id</span><span class="p">])</span>
<span class="lineno">202</span>         <span class="k">return</span> <span class="n">sorted_results</span>
<span class="lineno">203</span> 
<span class="lineno">204</span>     <span class="k">def</span> <span class="nf">_wquery</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nbr_results</span><span class="p">,</span> <span class="n">nbr_boosts</span><span class="p">,</span> <span class="n">boosts</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
<span class="lineno">205</span>         <span class="n">nbr_boosts</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nbr_boosts</span><span class="p">)</span>
<span class="lineno">206</span>         <span class="c">#collect potential items&#39; ids</span>
<span class="lineno">207</span>         <span class="n">items_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_items_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="lineno">208</span>         <span class="c">#check if items_ids is not empty</span>
<span class="lineno">209</span>         <span class="k">if</span> <span class="n">items_ids</span> <span class="o">==</span> <span class="nb">set</span><span class="p">():</span>
<span class="lineno">210</span>             <span class="k">return</span> <span class="s">&quot;&quot;</span>
<span class="lineno">211</span>         <span class="c">#check the boosts and create boosts_dict</span>
<span class="lineno">212</span>         <span class="n">boosts_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="lineno">213</span>         <span class="k">if</span> <span class="n">nbr_boosts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="lineno">214</span>             <span class="n">boosts</span> <span class="o">=</span> <span class="n">boosts</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="lineno">215</span>             <span class="k">for</span> <span class="n">boost</span> <span class="ow">in</span> <span class="n">boosts</span><span class="p">:</span>
<span class="lineno">216</span>                 <span class="nb">type</span><span class="p">,</span> <span class="n">score</span> <span class="o">=</span> <span class="n">boost</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
<span class="lineno">217</span>                 <span class="n">boosts_dict</span><span class="p">[</span><span class="nb">type</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
<span class="lineno">218</span>         <span class="c">#rank them according to the scoring method</span>
<span class="lineno">219</span>         <span class="n">sorted_results</span> <span class="o">=</span> <span class="n">SortedItems</span><span class="p">(</span><span class="n">nbr_results</span><span class="p">)</span>
<span class="lineno">220</span>         <span class="k">for</span> <span class="n">item_id</span> <span class="ow">in</span> <span class="n">items_ids</span><span class="p">:</span>
<span class="lineno">221</span>             <span class="n">item</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">item_id</span><span class="p">])</span>
<span class="lineno">222</span>             <span class="c">#chech the boost</span>
<span class="lineno">223</span>             <span class="k">if</span> <span class="n">nbr_boosts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="lineno">224</span>                 <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">boosts_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<span class="lineno">225</span>                     <span class="n">item</span><span class="o">.</span><span class="n">score</span> <span class="o">*=</span> <span class="n">boosts_dict</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
<span class="lineno">226</span>                 <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="n">boosts_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<span class="lineno">227</span>                     <span class="n">item</span><span class="o">.</span><span class="n">score</span> <span class="o">*=</span> <span class="n">boosts_dict</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">type</span><span class="p">]</span>
<span class="lineno">228</span>             <span class="n">sorted_results</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="lineno">229</span>         <span class="k">return</span> <span class="n">sorted_results</span>
<span class="lineno">230</span> 
<span class="lineno">231</span>     <span class="k">def</span> <span class="nf">process_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_command</span><span class="p">):</span>
<span class="lineno">232</span>         <span class="sd">&quot;&quot;&quot;</span>
<span class="lineno">233</span> <span class="sd">        validate the current command and map it to the right function</span>
<span class="lineno">234</span> <span class="sd">        &quot;&quot;&quot;</span>
<span class="lineno">235</span>         <span class="n">any_command</span> <span class="o">=</span> <span class="n">COMMAND_MATCHER</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">in_command</span><span class="p">)</span>
<span class="lineno">236</span>         <span class="c">#</span>
<span class="lineno">237</span>         <span class="k">if</span> <span class="n">any_command</span><span class="p">:</span>
<span class="lineno">238</span>             <span class="n">command</span> <span class="o">=</span> <span class="n">any_command</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&quot;command&quot;</span><span class="p">)</span>
<span class="lineno">239</span>             <span class="n">parameters</span> <span class="o">=</span> <span class="n">any_command</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&quot;parameters&quot;</span><span class="p">)</span>
<span class="lineno">240</span>             <span class="k">if</span> <span class="p">(</span><span class="n">command</span> <span class="o">==</span> <span class="s">&quot;ADD&quot;</span><span class="p">):</span>
<span class="lineno">241</span>                 <span class="n">add_command</span> <span class="o">=</span> <span class="n">ADD_COMMAND_MATCHER</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
<span class="lineno">242</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">_add</span><span class="p">(</span><span class="n">Item</span><span class="p">(</span><span class="n">add_command</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">),</span> <span class="n">add_command</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">),</span>
<span class="lineno">243</span>                            <span class="n">add_command</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&quot;score&quot;</span><span class="p">),</span> <span class="n">add_command</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&quot;content&quot;</span><span class="p">)))</span>
<span class="lineno">244</span>             <span class="k">elif</span> <span class="p">(</span><span class="n">command</span> <span class="o">==</span> <span class="s">&quot;DEL&quot;</span><span class="p">):</span>
<span class="lineno">245</span>                 <span class="n">del_command</span> <span class="o">=</span> <span class="n">DEL_COMMAND_MATCHER</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
<span class="lineno">246</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">_delete</span><span class="p">(</span><span class="n">del_command</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">))</span>
<span class="lineno">247</span>             <span class="k">elif</span> <span class="p">(</span><span class="n">command</span> <span class="o">==</span> <span class="s">&quot;QUERY&quot;</span><span class="p">):</span>
<span class="lineno">248</span>                 <span class="n">query_command</span> <span class="o">=</span> <span class="n">QUERY_COMMAND_MATCHER</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
<span class="lineno">249</span>                 <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query</span><span class="p">(</span><span class="n">query_command</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&quot;nbr_results&quot;</span><span class="p">),</span> <span class="n">query_command</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&quot;query&quot;</span><span class="p">))</span>
<span class="lineno">250</span>                 <span class="k">print</span> <span class="n">results</span>
<span class="lineno">251</span>             <span class="k">elif</span> <span class="p">(</span><span class="n">command</span> <span class="o">==</span> <span class="s">&quot;WQUERY&quot;</span><span class="p">):</span>
<span class="lineno">252</span>                 <span class="n">wquery_command</span> <span class="o">=</span> <span class="n">WQUERY_COMMAND_MATCHER</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
<span class="lineno">253</span>                 <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wquery</span><span class="p">(</span><span class="n">wquery_command</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&quot;nbr_results&quot;</span><span class="p">),</span> <span class="n">wquery_command</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&quot;nbr_boosts&quot;</span><span class="p">),</span>
<span class="lineno">254</span>                                         <span class="n">wquery_command</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&quot;boosts&quot;</span><span class="p">),</span> <span class="n">wquery_command</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&quot;query&quot;</span><span class="p">))</span>
<span class="lineno">255</span>                 <span class="k">print</span> <span class="n">results</span>
<span class="lineno">256</span> 
<span class="lineno">257</span> 
<span class="lineno">258</span> <span class="k">class</span> <span class="nc">Item</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="lineno">259</span>     <span class="sd">&quot;&quot;&quot;</span>
<span class="lineno">260</span> <span class="sd">    either a topic, a user, a board or a question</span>
<span class="lineno">261</span> 
<span class="lineno">262</span> <span class="sd">    @type type: str</span>
<span class="lineno">263</span> <span class="sd">    @param type: The item&#39;s type.</span>
<span class="lineno">264</span> 
<span class="lineno">265</span> <span class="sd">    @type id: str</span>
<span class="lineno">266</span> <span class="sd">    @param id: The item&#39;s id.</span>
<span class="lineno">267</span> 
<span class="lineno">268</span> <span class="sd">    @type score: float</span>
<span class="lineno">269</span> <span class="sd">    @param score: The item&#39;s score.</span>
<span class="lineno">270</span> 
<span class="lineno">271</span> <span class="sd">    @type content: str</span>
<span class="lineno">272</span> <span class="sd">    @param contetn: The item&#39;s content.</span>
<span class="lineno">273</span> 
<span class="lineno">274</span> <span class="sd">    @type time: time</span>
<span class="lineno">275</span> <span class="sd">    @param time: The item&#39;s time of creation.</span>
<span class="lineno">276</span> <span class="sd">    &quot;&quot;&quot;</span>
<span class="lineno">277</span> 
<span class="lineno">278</span>     <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
<span class="lineno">279</span>         <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
<span class="lineno">280</span>         <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
<span class="lineno">281</span>         <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
<span class="lineno">282</span>         <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span>
<span class="lineno">283</span>         <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="lineno">284</span> 
<span class="lineno">285</span>     <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno">286</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
<span class="lineno">287</span> 
<span class="lineno">288</span>     <span class="k">def</span> <span class="nf">better_than</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="lineno">289</span>         <span class="sd">&quot;&quot;&quot;</span>
<span class="lineno">290</span> <span class="sd">        compare the current item to the input item.</span>
<span class="lineno">291</span> <span class="sd">        follows this method:</span>
<span class="lineno">292</span> <span class="sd">            . highest score goes first.</span>
<span class="lineno">293</span> <span class="sd">            . same score; time FIFO.</span>
<span class="lineno">294</span> <span class="sd">        return true if the current item is better than the input, otherwise returns false</span>
<span class="lineno">295</span> <span class="sd">        &quot;&quot;&quot;</span>
<span class="lineno">296</span>         <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">&gt;</span> <span class="n">item</span><span class="o">.</span><span class="n">score</span><span class="p">):</span>
<span class="lineno">297</span>             <span class="k">return</span> <span class="bp">True</span>
<span class="lineno">298</span>         <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">&lt;</span> <span class="n">item</span><span class="o">.</span><span class="n">score</span><span class="p">):</span>
<span class="lineno">299</span>             <span class="k">return</span> <span class="bp">False</span>
<span class="lineno">300</span>         <span class="k">return</span> <span class="bp">True</span> <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;</span> <span class="n">item</span><span class="o">.</span><span class="n">time</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
<span class="lineno">301</span> 
<span class="lineno">302</span> 
<span class="lineno">303</span> <span class="k">class</span> <span class="nc">SortedItems</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="lineno">304</span>     <span class="sd">&quot;&quot;&quot;</span>
<span class="lineno">305</span> <span class="sd">    Keeps a list of sorted elements depending on the scoring method.</span>
<span class="lineno">306</span> 
<span class="lineno">307</span> <span class="sd">    @type items: list</span>
<span class="lineno">308</span> <span class="sd">    @param items: the list sorted items  </span>
<span class="lineno">309</span> 
<span class="lineno">310</span> <span class="sd">    @type max_size: int</span>
<span class="lineno">311</span> <span class="sd">    @param max_sier: the max size of the list (-1 means unlimited number of items)</span>
<span class="lineno">312</span> <span class="sd">    &quot;&quot;&quot;</span>
<span class="lineno">313</span> 
<span class="lineno">314</span>     <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
<span class="lineno">315</span>         <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
<span class="lineno">316</span>         <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_size</span><span class="p">)</span>
<span class="lineno">317</span> 
<span class="lineno">318</span>     <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno">319</span>         <span class="k">return</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">item</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">])</span>
<span class="lineno">320</span> 
<span class="lineno">321</span>     <span class="k">def</span> <span class="nf">set_max_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_size</span><span class="p">):</span>
<span class="lineno">322</span>         <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_size</span><span class="p">)</span>
<span class="lineno">323</span> 
<span class="lineno">324</span>     <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="lineno">325</span>         <span class="sd">&quot;&quot;&quot;</span>
<span class="lineno">326</span> <span class="sd">        add new item to the list of items.</span>
<span class="lineno">327</span> <span class="sd">        if the list is full, add the item only if it has better score than at least one item</span>
<span class="lineno">328</span> <span class="sd">        in the list, and pop the item with the worst score.</span>
<span class="lineno">329</span> <span class="sd">        &quot;&quot;&quot;</span>
<span class="lineno">330</span>         <span class="n">items_l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>
<span class="lineno">331</span>         <span class="n">pos</span> <span class="o">=</span> <span class="n">items_l</span>
<span class="lineno">332</span>         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">items_l</span><span class="p">):</span>
<span class="lineno">333</span>             <span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">better_than</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
<span class="lineno">334</span>                 <span class="n">pos</span> <span class="o">=</span> <span class="n">i</span>
<span class="lineno">335</span>                 <span class="k">break</span>  
<span class="lineno">336</span>         <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_size</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="p">):</span>
<span class="lineno">337</span>             <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[:</span><span class="n">pos</span><span class="p">]</span>
<span class="lineno">338</span>             <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="lineno">339</span>             <span class="n">temp</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">pos</span><span class="p">:]</span>
<span class="lineno">340</span>             <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="n">temp</span>
<span class="lineno">341</span>             <span class="c">#now in the case of exceeding max_size</span>
<span class="lineno">342</span>             <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_size</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">items_l</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="p">):</span>
<span class="lineno">343</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="lineno">344</span> 
<span class="lineno">345</span> 
<span class="lineno">346</span> <span class="n">t</span> <span class="o">=</span> <span class="n">TypeHead</span><span class="p">()</span>
<span class="lineno">347</span> <span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">raw_input</span><span class="p">())</span>
<span class="lineno">348</span> <span class="k">while</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<span class="lineno">349</span>     <span class="n">t</span><span class="o">.</span><span class="n">process_command</span><span class="p">(</span><span class="nb">raw_input</span><span class="p">())</span>
<span class="lineno">350</span>     <span class="n">N</span> <span class="o">-=</span> <span class="mi">1</span></code></pre></div>

</id></sorted>

            
<div class="social">
  
  <div class='twitter'>
    <a href="https://twitter.com/share" class="twitter-share-button"  data-text="Quora Typeahead search." data-related="mmourafiq">Tweet</a>
  </div>
  

  
  <div class='facebook'>
    <div class="fb-share-button" data-layout="button_count"></div>
  </div>
  

  
  <div class='google'>
    <div class="g-plusone" data-size="medium"></div>
  </div>
  
    
  
  <div class='hn'>
    <a href="https://news.ycombinator.com/submit" class="hn-button" data-title="Quora Typeahead search." data-url="http://mourafiq.com/2012/11/01/quora-type-ahead.html" data-count="horizontal">Vote on Hacker News</a>
  </div>
  

  
  <div class='reddit'>
    <a href="//www.reddit.com/submit" onclick="window.open('//www.reddit.com/submit?url=http://mourafiq.com/2012/11/01/quora-type-ahead.html&title=Quora+Typeahead+search.'); return false"> <img src="//www.redditstatic.com/spreddit7.gif" alt="submit to reddit" border="0" /> </a>
  </div>
  
</div>

        </section>

        <footer>
            <address>
                <img src="/images/logo.png">
                <p>
                Written by <strong><a rel="author" href="https://twitter.com/mmourafiq" title="Mourad Mourafiq." target="_blank">Mourad Mourafiq.</a></strong><br>
                    <span class="muted">Maths, Technology, Philosophy, Startups, ...</span>
                </p>
            </address>
            
            
            <section class="post_summary">
                <h3 class="title">Next up: <a href="/2012/11/15/quora-answer-classifier-1.html" rel="prefetch">Quora Answer Classifier (Part 1, with decision tree learning).</a></h3>
                <p>Designing an algorithm to develop classifier that is able to tell good answers from bad answers, as well as humans can.</p>
                <hr>
            </section>
             
            
            
            <section class="post_summary">
                <h3 class="title">Previous story: <a href="/2012/10/15/quora-nearby.html" rel="prefetch">Quora Nearby.</a></h3>
                <p>Designing an algorithm to find topics or questions that are near to a given input location, up to a specified limit.</p>
                <hr>
            </section>
             
            
            <section>
                <div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname = 'mourafiq';

  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
            </section>
            
        </footer>
    </div>
</article>


    <footer class="site-footer">
        <div class="container">
            &copy; 2018 Mourad Mourafiq

            <nav>
                <a href="/">Blog</a> &middot;
                <a href="/about.html">About</a>
            </nav>

            <nav class="social">
                
<a href="https://twitter.com/mmourafiq" title="Follow on Twitter" target="_blank"><i class="icon icon-twitter"></i></a>


<a href="https://github.com/mouradmourafiq" title="Watch on Github" target="_blank"><i class="icon icon-github"></i></a>


<a href="/atom.xml" title="RSS Feed">
  <i class="icon icon-rss"></i>
</a>

            </nav>
            <div>Based on Incorporated theme by <a href="https://sendtoinc.com">Inc</a></div>
        </div>
    </footer>

</body>
</html>
